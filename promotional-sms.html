<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promotional SMS | Icon Lounge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-black text-zinc-300 flex h-screen lg:overflow-hidden">
    <!-- Mobile Backdrop: Hidden by default, visible when sidebar is open on mobile -->
    <div id="sidebarBackdrop" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 z-40 hidden lg:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed inset-y-0 left-0 z-50 w-64 bg-zinc-900 border-r border-zinc-800 flex flex-col transition-transform duration-300 transform -translate-x-full lg:translate-x-0 lg:static">
        <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
            <img src="images/iconnlounge-logo-removebg-preview.png" class="h-8" alt="Logo">
            <!-- Mobile Close Button -->
            <button onclick="toggleSidebar()" class="lg:hidden text-zinc-500 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded hover:bg-zinc-800 transition">
                <i class="fas fa-chart-line"></i> <span>Dashboard</span>
            </a>
            <a href="customer-directory.html"
                class="flex items-center space-x-3 p-3 rounded hover:bg-zinc-800 transition">
                <i class="fas fa-address-book"></i> <span>Customers</span>
            </a>
            <a href="served-customers.html"
                class="flex items-center space-x-3 p-3 rounded hover:bg-zinc-800 transition">
                <i class="fas fa-user-check"></i> <span>Served Customers</span>
            </a>
            <a href="promotional-sms.html" class="flex items-center space-x-3 p-3 rounded bg-zinc-800 text-[#d4af37]">
                <i class="fas fa-bullhorn"></i> <span>Promotions (SA)</span>
            </a>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col min-h-0 overflow-hidden">
        <header class="h-16 border-b border-zinc-800 flex items-center justify-between px-4 lg:px-8 bg-zinc-900">
            <!-- Mobile Menu Toggle -->
            <button onclick="toggleSidebar()" class="lg:hidden text-[#d4af37] mr-4">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-xl font-bold">Bulk Promotions</h1>
            <div id="targetCounter" class="text-sm font-bold text-[#d4af37]">0 Recipients Selected</div>
        </header>

        <section class="p-8 overflow-y-auto flex-1 max-w-5xl mx-auto w-full">
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">

                <!-- Left: Filters & Selection -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-zinc-900 p-6 rounded-lg border border-zinc-800">
                        <h3 class="text-xs font-bold text-zinc-500 uppercase mb-4">Filter Contacts</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-xs text-zinc-400">By Registration Month</label>
                                <input type="month" id="filterMonth" onchange="calculateAudience()"
                                    class="w-full bg-black border border-zinc-700 rounded p-2 text-sm mt-1">
                            </div>
                            <div>
                                <label class="text-xs text-zinc-400">Manual Numbers (Comma separated)</label>
                                <textarea id="manualNumbers" oninput="calculateAudience()"
                                    placeholder="23324..., 020..."
                                    class="w-full bg-black border border-zinc-700 rounded p-2 text-sm mt-1 h-20"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Message Content -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-zinc-900 p-6 rounded-lg border border-zinc-800">
                        <h3 class="text-xs font-bold text-zinc-500 uppercase mb-4">Compose Message</h3>
                        <textarea id="promoText" oninput="updatePromoPreview()"
                            placeholder="Type your promotion here... Use {{first_name}} for personalization"
                            class="w-full bg-black border border-zinc-700 rounded p-4 h-48 text-base outline-none focus:border-[#d4af37]"></textarea>

                        <!-- NEW: Variable Tag Row -->
                        <div class="flex items-center gap-2 mt-3 mb-4">
                            <span class="text-[10px] text-zinc-500 uppercase font-bold">Personalize:</span>
                            <button type="button" onclick="insertVariable('promoText', '{{first_name}}')"
                                class="text-[10px] bg-zinc-800 border border-[#d4af37] text-[#d4af37] px-2 py-1 rounded hover:bg-[#d4af37] hover:text-black transition">
                                <i class="fas fa-plus-circle"></i> Customer Name
                            </button>
                        </div>
                        <div class="flex gap-4 mt-4">
                            <label class="flex items-center space-x-2 text-xs cursor-pointer">
                                <input type="checkbox" id="promoWebsite" onchange="updatePromoPreview()">
                                <span>Include Website</span>
                            </label>
                            <label class="flex items-center space-x-2 text-xs cursor-pointer">
                                <input type="checkbox" id="promoReview" onchange="updatePromoPreview()">
                                <span>Include Review Link</span>
                            </label>
                        </div>

                        <div class="mt-6 p-4 bg-black rounded border border-dashed border-zinc-700">
                            <p class="text-[10px] uppercase text-zinc-500 mb-2">Live Preview (Fallback Name)</p>
                            <div id="promoPreview" class="text-sm text-zinc-400 font-mono italic whitespace-pre-wrap">
                            </div>
                        </div>
                        <p id="promoCharCount" class="text-right text-[10px] text-zinc-500 mt-2">0 characters (1
                            segment)</p>
                    </div>

                    <button id="sendBulkBtn" onclick="handleSendBulk()"
                        class="w-full bg-[#d4af37] text-black font-bold py-4 rounded-lg hover:bg-yellow-600 transition flex items-center justify-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-paper-plane"></i>
                        <span>Blast Promotional SMS</span>
                    </button>

                    <!-- Progress Bar (Hidden by default) -->
                    <div id="progressArea" class="hidden">
                        <div class="w-full bg-zinc-800 rounded-full h-2">
                            <div id="progressBar" class="bg-[#d4af37] h-2 rounded-full transition-all duration-300"
                                style="width: 0%"></div>
                        </div>
                        <p id="progressStatus" class="text-center text-xs mt-2 text-zinc-500">Sending 0 of 0...</p>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <div id="toast"
        class="fixed bottom-8 right-8 bg-[#d4af37] text-black px-6 py-3 rounded-lg shadow-2xl font-bold transform translate-y-20 opacity-0 transition-all duration-300 z-[100]">
    </div>

    <script src="admin-config.js"></script>
    <script src="sms-helper.js"></script>
    <script src="promotional-sms.js"></script>
</body>

</html>